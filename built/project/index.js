//     BackboneUiDraggable
//     (c) simonfan
//     BackboneUiDraggable is licensed under the MIT terms.

define(["require","exports","module","lowercase-backbone","model-dock","lodash","jquery","./__backbone-ui-draggable/move"],function(e,t,n){function a(e){return u.test(e)?e+"px":e}function f(e){return parseInt(e)}var r=e("lowercase-backbone"),i=e("model-dock"),s=e("lodash"),o=e("jquery"),u=/^[0-9\-]+$/,l=n.exports=i.extend({initialize:function(t){r.view.prototype.initialize.call(this,t),this.initializeModelDock(t),this.initializeUIDraggable(t)},initializeUIDraggable:function(t){s.bindAll(this,"mousedown","mousemove","mouseup"),this.$window=o(window),this.$canvas=t.canvas||this.canvas||this.$el.parent();var n=this.$el.position(),r=o.extend({status:"stopped",top:f(n.top),left:f(n.left)},t),i=this.model;i.set(r);var u=this.valueAttribute;this.listenTo(i,"change:"+u,function(e,t){var n=this.toPosition(e.get(u));e.set({top:f(n.top),left:f(n.left)})},this);if(i.get(u)){var n=this.toPosition(i.get(u));i.set({top:f(n.top),left:f(n.left)})}else i.set(u,this.toValue(i))},events:{mousedown:"mousedown"},mousedown:function(t){if(this.$el.is(t.target)&&t.which===1){this.model.set("status","dragging"),this.lastPosition={x:t.pageX,y:t.pageY};var n=this.$el.offset();return this.handlePosition={x:t.pageX-n.left,y:t.pageY-n.top},this.$window.on("mousemove",this.mousemove).on("mouseup",this.mouseup),this.trigger("movestart",this),!1}},mousemove:function(t){var n=this.lastPosition,r=t.pageX,i=t.pageY,s=r-n.x,o=i-n.y,u=this.$el.offset(),a=this.handlePosition.x+u.left,f=this.handlePosition.y+u.top;return(s>0&&r>a||s<0&&r<a)&&this.moveX(s,{agent:"mousemove"}),(o>0&&i>f||o<0&&i<f)&&this.moveY(o,{agent:"mousemove"}),n.x=r,n.y=i,!1},mouseup:function(){this.$window.off("mousemove",this.mousemove),delete this.lastPosition,this.model.set("status","stopped"),this.trigger("movestop",this)},axis:"xy",valueAttribute:"value",setValue:function(t){return this.model.set(this.valueAttribute,t),this},toValue:function(t){return"At "+t.get("top")+" x "+t.get("left")},toPosition:function(t){var n=t.split("x");return{top:n[0].replace(/[^0-9\-]/g,""),left:n[1].replace(/[^0-9\-]/g,"")}},map:{left:"->css:left",top:"->css:top"},stringifiers:{left:a,top:a}});l.proto(e("./__backbone-ui-draggable/move"))});