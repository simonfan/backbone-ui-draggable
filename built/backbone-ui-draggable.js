//     BackboneUiDraggable
//     (c) simonfan
//     BackboneUiDraggable is licensed under the MIT terms.

define("__backbone-ui-draggable/move",["require","exports","module","lodash"],function(t,e){function i(t,e,i){return isNaN(e)||(t=t>e?t:e),isNaN(i)||(t=i>t?t:i),t}function o(t){return parseInt(t,10)}var s=t("lodash");e.moveX=function(t,e){if(t){if(e=e||{},-1===this.axis.indexOf("x"))return t;var n=this.model,a=parseInt(n.get("left"),10),r=a+t,u=o(n.get("minX")),l=o(n.get("maxX"))-o(this.$el.width()),h=i(r,u,l);n.set("left",o(h)),n.set(this.valueAttribute,this.toValue(n));var f=n.get("left")-a;if(!e.silent){var m=s.assign({axis:"x",delta:f},e);this.trigger("move",this,m).trigger("move-x",this,m)}return t-f}return 0},e.moveY=function(t,e){if(t){if(e=e||{},-1===this.axis.indexOf("y"))return t;var n=this.model,a=parseInt(n.get("top"),10),r=a+t,u=o(n.get("minY")),l=o(n.get("maxY"))-o(this.$el.height()),h=i(r,u,l);n.set("top",o(h)),n.set(this.valueAttribute,this.toValue(n));var f=n.get("top")-a;if(!e.silent){var m=s.assign({axis:"y",delta:f},e);this.trigger("move",this,m).trigger("move-y",this,m)}return t-f}return 0},e.moveToLeft=function(t,e){return-1*this.moveX(-1*t,e)},e.moveToRight=function(t,e){return this.moveX(t,e)},e.moveToTop=function(t,e){return-1*this.moveY(-1*t,e)},e.moveToBottom=function(t,e){return this.moveY(t,e)}}),define("backbone-ui-draggable",["require","exports","module","lowercase-backbone","model-dock","lodash","jquery","./__backbone-ui-draggable/move"],function(t,e,i){function o(t){return l.test(t)?t+"px":t}function s(t){return parseInt(t)}var n=t("lowercase-backbone"),a=t("model-dock"),r=t("lodash"),u=t("jquery"),l=/^[0-9\-]+$/,h=i.exports=a.extend({initialize:function(t){n.view.prototype.initialize.call(this,t),this.initializeModelDock(t),this.initializeUIDraggable(t)},initializeUIDraggable:function(t){r.bindAll(this,"mousedown","mousemove","mouseup"),this.$window=u(window),this.$canvas=t.canvas||this.canvas||this.$el.parent();var e=this.$el.position(),i=u.extend({status:"stopped",top:s(e.top),left:s(e.left)},t),o=this.model;o.set(i);var n=this.valueAttribute;if(this.listenTo(o,"change:"+n,function(t){var e=this.toPosition(t.get(n));t.set({top:s(e.top),left:s(e.left)})},this),o.get(n)){var e=this.toPosition(o.get(n));o.set({top:s(e.top),left:s(e.left)})}else o.set(n,this.toValue(o))},events:{mousedown:"mousedown"},mousedown:function(t){if(this.$el.is(t.target)&&1===t.which){this.model.set("status","dragging"),this.lastPosition={x:t.pageX,y:t.pageY};var e=this.$el.offset();return this.handlePosition={x:t.pageX-e.left,y:t.pageY-e.top},this.$window.on("mousemove",this.mousemove).on("mouseup",this.mouseup),this.trigger("movestart",this),!1}},mousemove:function(t){var e=this.lastPosition,i=t.pageX,o=t.pageY,s=i-e.x,n=o-e.y,a=this.$el.offset(),r=this.handlePosition.x+a.left,u=this.handlePosition.y+a.top;return(s>0&&i>r||0>s&&r>i)&&this.moveX(s),(n>0&&o>u||0>n&&u>o)&&this.moveY(n),e.x=i,e.y=o,!1},mouseup:function(){this.$window.off("mousemove",this.mousemove),delete this.lastPosition,this.model.set("status","stopped"),this.trigger("movestop",this)},axis:"xy",valueAttribute:"value",setValue:function(t){return this.model.set(this.valueAttribute,t),this},toValue:function(t){return"At "+t.get("top")+" x "+t.get("left")},toPosition:function(t){var e=t.split("x");return{top:e[0].replace(/[^0-9\-]/g,""),left:e[1].replace(/[^0-9\-]/g,"")}},map:{left:"->css:left",top:"->css:top"},stringifiers:{left:o,top:o}});h.proto(t("./__backbone-ui-draggable/move"))});