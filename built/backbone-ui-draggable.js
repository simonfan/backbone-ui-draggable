//     BackboneUiDraggable
//     (c) simonfan
//     BackboneUiDraggable is licensed under the MIT terms.

define("__backbone-ui-draggable/helpers",["require","exports","module"],function(e,t){t.min=function(e,t){return isNaN(e)?t:isNaN(t)?e:t>e?e:t},t.max=function(e,t){return isNaN(e)?t:isNaN(t)?e:e>t?e:t},t.fitValueWithin=function(e,t,i){return isNaN(t)||(e=e>t?e:t),isNaN(i)||(e=i>e?e:i),e};var i=/^-?\d*(\.\d+)?$/;t.stringifyPositionalValue=function(e){return i.test(e)?e+"px":e}}),define("__backbone-ui-draggable/delta-calc",["require","exports","module","lodash","./helpers"],function(e,t){var i=(e("lodash"),e("./helpers"));t.xAllowedDelta=function(e){e=+e;var t=this.model,a=+t.get("left"),o=a+e,n=+this.$el.width(),s=+t.get("minLeft"),l=+t.get("minRight"),r=i.max(s,l-n),u=+t.get("maxLeft"),d=+t.get("maxRight"),g=i.min(u,d-n),b=i.fitValueWithin(o,r,g);return b-a},t.yAllowedDelta=function(e){e=+e;var t=this.model,a=+t.get("top"),o=a+e,n=+this.$el.height(),s=+t.get("minTop"),l=+t.get("minBottom"),r=i.max(s,l-n),u=+t.get("maxTop"),d=+t.get("maxBottom"),g=i.min(u,d-n),b=i.fitValueWithin(o,r,g);return b-a}}),define("__backbone-ui-draggable/movement",["require","exports","module","lodash","./helpers"],function(e,t){{var i=e("lodash");e("./helpers")}t.beforeMoveX=function(){},t.moveX=function(e,t){if(e){if(t=t||{},-1===this.axis.indexOf("x"))return e;var a=this.model,o=t.force?e:this.xAllowedDelta(e),n=this.beforeMoveX(o,t);o=i.isNumber(n)?n:o;var s=+a.get("left");if(a.set("left",s+o),!t.silent&&0!==o){var l=i.assign({axis:"x",delta:o,direction:o>0?"right":"left"},t);this.trigger("move",this,l).trigger("move-x",this,l)}return e-o}return 0},t.beforeMoveY=function(){},t.moveY=function(e,t){if(e){if(t=t||{},-1===this.axis.indexOf("y"))return e;var a=this.model,o=this.yAllowedDelta(e),n=this.beforeMoveY(o,t);o=i.isNumber(n)?n:o;var s=+a.get("top");if(a.set("top",s+o),!t.silent&&0!==o){var l=i.assign({axis:"y",delta:o,direction:o>0?"bottom":"top"},t);this.trigger("move",this,l).trigger("move-y",this,l)}return e-o}return 0},t.moveToLeft=function(e,t){return-1*this.moveX(-1*e,t)},t.moveToRight=function(e,t){return this.moveX(e,t)},t.moveToTop=function(e,t){return-1*this.moveY(-1*e,t)},t.moveToBottom=function(e,t){return this.moveY(e,t)}}),define("__backbone-ui-draggable/animation",["require","exports","module","lodash"],function(e,t){var i=e("lodash");t.animateX=function(e,t){var a=this.xAllowedDelta(e);t=t||{},t=i.isObject(t)?t:{duration:arguments[1],easing:arguments[2],complete:arguments[3]};var o=this.$el.position().left;return t.step=i.bind(function(e){this.moveX(e-o,{force:!0}),o=e},this),this.$el.animate({left:+this.model.get("left")+a},t),e-a},t.animateY=function(e,t){var a=this.yAllowedDelta(e);t=t||{},t=i.isObject(t)?t:{duration:arguments[1],easing:arguments[2],complete:arguments[3]};var o=this.$el.position().top;return t.step=i.bind(function(e){this.moveY(e-o,{force:!0}),o=e},this),this.$el.animate({top:+this.model.get("top")+a},t),e-a},t.animateToLeft=function(e,t){return-1*this.animateX(-1*e,t)},t.animateToRight=function(e,t){return this.animateX(e,t)},t.animateToTop=function(e,t){return-1*this.animateY(-1*e,t)},t.animateToBottom=function(e,t){return this.animateY(e,t)}}),define("__backbone-ui-draggable/event-handlers",["require","exports","module"],function(e,t){t.mousedown=function(e){if(this.$el.is(e.target)&&1===e.which&&this.draggableEnabled()){this.lastPosition={x:e.pageX,y:e.pageY};var t=this.$el.offset();return this.handlePosition={x:e.pageX-t.left,y:e.pageY-t.top},this.$window.on("mousemove",this.mousemove).on("mouseup",this.mouseup),this.trigger("movestart",this),!1}},t.mousemove=function(e){var t=this.lastPosition,i=e.pageX,a=e.pageY,o=i-t.x,n=a-t.y,s=this.$el.offset(),l=this.handlePosition.x+s.left,r=this.handlePosition.y+s.top;return(o>0&&i>l||0>o&&l>i)&&this.moveX(o,{agent:"mousemove"}),(n>0&&a>r||0>n&&r>a)&&this.moveY(n,{agent:"mousemove"}),t.x=i,t.y=a,!1},t.mouseup=function(){this.$window.off("mousemove",this.mousemove),delete this.lastPosition,this.trigger("movestop",this)}}),define("__backbone-ui-draggable/enable-disable",["require","exports","module"],function(e,t){t.initializeUIDraggableEnableDisable=function(){var e=this.model;this.listenTo(e,"change:draggableStatus",function(){this.draggableEnabled()?this.$el.removeClass(this.draggableClass+"-disabled").addClass(this.draggableClass+"-enabled"):this.$el.removeClass(this.draggableClass+"-enabled").addClass(this.draggableClass+"-disabled")})},t.disableDraggable=function(){this.model.set("draggableStatus","disabled")},t.enableDraggable=function(){this.model.set("draggableStatus","enabled")},t.draggableEnabled=function(){return"enabled"===this.model.get("draggableStatus")}}),define("backbone-ui-draggable",["require","exports","module","lowercase-backbone","bb-model-view","lodash","jquery","./__backbone-ui-draggable/helpers","./__backbone-ui-draggable/delta-calc","./__backbone-ui-draggable/movement","./__backbone-ui-draggable/animation","./__backbone-ui-draggable/event-handlers","./__backbone-ui-draggable/enable-disable"],function(e,t,i){var a=e("lowercase-backbone"),o=e("bb-model-view"),n=e("lodash"),s=e("jquery"),l=e("./__backbone-ui-draggable/helpers"),r=i.exports=o.extend({initialize:function(e){a.view.prototype.initialize.call(this,e),this.model||(this.model=a.model()),this.initializeModelView(e),this.initializeUIDraggable(e)},initializeUIDraggable:function(e){n.bindAll(this,"mousedown","mousemove","mouseup"),this.$el.addClass(this.draggableClass),this.$window=s(window),this.$canvas=e.canvas||this.canvas||this.$el.parent(),this.initializeUIDraggableEnableDisable();var t=this.$el.position(),i=s.extend({draggableStatus:"enabled",top:+t.top,left:+t.left},e);this.model.set(i)},draggableClass:"draggable",events:{mousedown:"mousedown"},axis:"xy",map:{left:"->css:left",top:"->css:top"},stringifiers:{left:l.stringifyPositionalValue,top:l.stringifyPositionalValue}});r.proto(e("./__backbone-ui-draggable/delta-calc")).proto(e("./__backbone-ui-draggable/movement")).proto(e("./__backbone-ui-draggable/animation")).proto(e("./__backbone-ui-draggable/event-handlers")).proto(e("./__backbone-ui-draggable/enable-disable"))});