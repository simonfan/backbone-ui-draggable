//     BackboneUiDraggable
//     (c) simonfan
//     BackboneUiDraggable is licensed under the MIT terms.

define("__backbone-ui-draggable/helpers",["require","exports","module"],function(e,t){t.min=function(e,t){return isNaN(e)?t:isNaN(t)?e:t>e?e:t},t.max=function(e,t){return isNaN(e)?t:isNaN(t)?e:e>t?e:t},t.fitValueWithin=function(e,t,i){return isNaN(t)||(e=e>t?e:t),isNaN(i)||(e=i>e?e:i),e};var i=/^[0-9\-]+$/;t.stringifyPositionalValue=function(e){return i.test(e)?e+"px":e}}),define("__backbone-ui-draggable/value-position",["require","exports","module","./helpers"],function(e,t){e("./helpers");t.initializeDraggableValuePosition=function(){var e=this.model,t=this.valueAttribute;if(this.listenTo(e,"change:"+t,function(e){var i=this.toPosition(e.get(t));e.set({top:parseInt(i.top,10),left:parseInt(i.left,10)})},this),e.get(t)){var i=this.toPosition(e.get(t));e.set({top:parseInt(i.top,10),left:parseInt(i.left,10)})}else e.set(t,this.toValue(e))},t.valueAttribute="value",t.setValue=function(e){return this.model.set(this.valueAttribute,e),this},t.toValue=function(e){return"At "+e.get("top")+" x "+e.get("left")},t.toPosition=function(e){var t=e.split("x");return{top:t[0].replace(/[^0-9\-]/g,""),left:t[1].replace(/[^0-9\-]/g,"")}}}),define("__backbone-ui-draggable/movement",["require","exports","module","lodash","./helpers"],function(e,t){var i=e("lodash"),s=e("./helpers");t.moveX=function(e,t){if(e){if(t=t||{},-1===this.axis.indexOf("x"))return e;var o=this.model,n=parseInt(o.get("left"),10),a=n+e,r=parseInt(this.$el.width(),10),l=parseInt(o.get("minLeft"),10),u=parseInt(o.get("minRight"),10),h=s.max(l,u-r),d=parseInt(o.get("maxLeft"),10),g=parseInt(o.get("maxRight"),10),m=s.min(d,g-r),p=s.fitValueWithin(a,h,m);o.set("left",parseInt(p),10),o.set(this.valueAttribute,this.toValue(o));var f=o.get("left")-n;if(!t.silent&&0!==f){var b=i.assign({axis:"x",delta:f,direction:f>0?"right":"left"},t);this.trigger("move",this,b).trigger("move-x",this,b)}return e-f}return 0},t.moveY=function(e,t){if(e){if(t=t||{},-1===this.axis.indexOf("y"))return e;var o=this.model,n=parseInt(o.get("top"),10),a=n+e,r=parseInt(this.$el.height(),10),l=parseInt(o.get("minTop"),10),u=parseInt(o.get("minBottom"),10),h=s.max(l,u-r),d=parseInt(o.get("maxTop"),10),g=parseInt(o.get("maxBottom"),10),m=s.min(d,g-r),p=s.fitValueWithin(a,h,m);o.set("top",parseInt(p)),o.set(this.valueAttribute,this.toValue(o));var f=o.get("top")-n;if(!t.silent&&0!==f){var b=i.assign({axis:"y",delta:f,direction:f>0?"bottom":"top"},t);this.trigger("move",this,b).trigger("move-y",this,b)}return e-f}return 0},t.moveToLeft=function(e,t){return-1*this.moveX(-1*e,t)},t.moveToRight=function(e,t){return this.moveX(e,t)},t.moveToTop=function(e,t){return-1*this.moveY(-1*e,t)},t.moveToBottom=function(e,t){return this.moveY(e,t)}}),define("__backbone-ui-draggable/event-handlers",["require","exports","module"],function(e,t){t.mousedown=function(e){if(this.$el.is(e.target)&&1===e.which&&!this.model.get("disabled")){this.model.set("status","dragging"),this.lastPosition={x:e.pageX,y:e.pageY};var t=this.$el.offset();return this.handlePosition={x:e.pageX-t.left,y:e.pageY-t.top},this.$window.on("mousemove",this.mousemove).on("mouseup",this.mouseup),this.trigger("movestart",this),!1}},t.mousemove=function(e){var t=this.lastPosition,i=e.pageX,s=e.pageY,o=i-t.x,n=s-t.y,a=this.$el.offset(),r=this.handlePosition.x+a.left,l=this.handlePosition.y+a.top;return(o>0&&i>r||0>o&&r>i)&&this.moveX(o,{agent:"mousemove"}),(n>0&&s>l||0>n&&l>s)&&this.moveY(n,{agent:"mousemove"}),t.x=i,t.y=s,!1},t.mouseup=function(){this.$window.off("mousemove",this.mousemove),delete this.lastPosition,this.model.set("status","stopped"),this.trigger("movestop",this)}}),define("backbone-ui-draggable",["require","exports","module","lowercase-backbone","model-dock","lodash","jquery","./__backbone-ui-draggable/helpers","./__backbone-ui-draggable/value-position","./__backbone-ui-draggable/movement","./__backbone-ui-draggable/event-handlers"],function(e,t,i){var s=e("lowercase-backbone"),o=e("model-dock"),n=e("lodash"),a=e("jquery"),r=e("./__backbone-ui-draggable/helpers"),l=i.exports=o.extend({initialize:function(e){s.view.prototype.initialize.call(this,e),this.initializeModelDock(e),this.initializeUIDraggable(e)},initializeUIDraggable:function(e){n.bindAll(this,"mousedown","mousemove","mouseup"),this.$window=a(window),this.$canvas=e.canvas||this.canvas||this.$el.parent();var t=this.$el.position(),i=a.extend({status:"stopped",disabled:!1,top:parseInt(t.top,10),left:parseInt(t.left,10)},e),s=this.model;s.set(i),this.listenTo(s,"change:disabled",function(e){e.get("disabled")?this.$el.removeClass("enabled").addClass("disabled"):this.$el.removeClass("disabled").addClass("enabled")}),this.initializeDraggableValuePosition(e)},events:{mousedown:"mousedown"},disable:function(){this.model.set("disabled",!0)},enable:function(){this.model.set("disabled",!1)},axis:"xy",map:{left:"->css:left",top:"->css:top"},stringifiers:{left:r.stringifyPositionalValue,top:r.stringifyPositionalValue}});l.proto(e("./__backbone-ui-draggable/value-position")),l.proto(e("./__backbone-ui-draggable/movement")),l.proto(e("./__backbone-ui-draggable/event-handlers"))});