//     BackboneUiDraggable
//     (c) simonfan
//     BackboneUiDraggable is licensed under the MIT terms.

define("__backbone-ui-draggable/helpers",["require","exports","module"],function(e,t){t.min=function(e,t){return isNaN(e)?t:isNaN(t)?e:t>e?e:t},t.max=function(e,t){return isNaN(e)?t:isNaN(t)?e:e>t?e:t},t.fitValueWithin=function(e,t,i){return isNaN(t)||(e=e>t?e:t),isNaN(i)||(e=i>e?e:i),e};var i=/^-?\d*(\.\d+)?$/;t.stringifyPositionalValue=function(e){return i.test(e)?e+"px":e}}),define("__backbone-ui-draggable/when",["require","exports","module","object-query"],function(e,t,i){var a=e("object-query");i.exports=function(e,t,i){var o=a(e),n=this.modeld;n.on("change",function(){o(n.toJSON())&&t.apply(i,[this])},this)}}),define("__backbone-ui-draggable/delta-calc",["require","exports","module","lodash","./helpers"],function(e,t){var i=(e("lodash"),e("./helpers")),a=parseFloat;t.xAllowedDelta=function(e){var t=this.modeld,o=a(t.get("left")),n=o+a(e),s=a(this.$el.width()),l=a(t.get("minLeft")),r=a(t.get("minRight")),d=i.max(l,r-s),u=a(t.get("maxLeft")),g=a(t.get("maxRight")),b=i.min(u,g-s),h=i.fitValueWithin(n,d,b);return h-o},t.yAllowedDelta=function(e){var t=this.modeld,o=a(t.get("top")),n=o+a(e),s=a(this.$el.height()),l=a(t.get("minTop")),r=a(t.get("minBottom")),d=i.max(l,r-s),u=a(t.get("maxTop")),g=a(t.get("maxBottom")),b=i.min(u,g-s),h=i.fitValueWithin(n,d,b);return h-o}}),define("__backbone-ui-draggable/movement",["require","exports","module","lodash","./helpers"],function(e,t){{var i=e("lodash");e("./helpers")}t.beforeMoveX=function(){},t.moveX=function(e,t){if(e){if(t=t||{},-1===this.axis.indexOf("x"))return e;var a=this.modeld,o=t.force?e:this.xAllowedDelta(e),n=this.beforeMoveX(o,t);if(o=i.isNumber(n)?n:o,a.set("left",parseFloat(a.get("left"))+o),!t.silent&&0!==o){var s=i.assign({axis:"x",delta:o,direction:o>0?"right":"left"},t);this.trigger("move",this,s).trigger("move-x",this,s)}return e-o}return 0},t.beforeMoveY=function(){},t.moveY=function(e,t){if(e){if(t=t||{},-1===this.axis.indexOf("y"))return e;var a=this.modeld,o=this.yAllowedDelta(e),n=this.beforeMoveY(o,t);if(o=i.isNumber(n)?n:o,a.set("top",parseFloat(a.get("top"))+o),!t.silent&&0!==o){var s=i.assign({axis:"y",delta:o,direction:o>0?"bottom":"top"},t);this.trigger("move",this,s).trigger("move-y",this,s)}return e-o}return 0},t.moveToLeft=function(e,t){return-1*this.moveX(-1*e,t)},t.moveToRight=function(e,t){return this.moveX(e,t)},t.moveToTop=function(e,t){return-1*this.moveY(-1*e,t)},t.moveToBottom=function(e,t){return this.moveY(e,t)}}),define("__backbone-ui-draggable/animation",["require","exports","module","lodash"],function(e,t){var i=e("lodash");t.animateX=function(e,t){var a=this.xAllowedDelta(e);t=t||{},t=i.isObject(t)?t:{duration:arguments[1],easing:arguments[2],complete:arguments[3]};var o=this.$el.position().left;return t.step=i.bind(function(e){this.moveX(e-o,{force:!0}),o=e},this),this.$el.animate({left:parseFloat(this.modeld.get("left"))+a},t),e-a},t.animateY=function(e,t){var a=this.yAllowedDelta(e);t=t||{},t=i.isObject(t)?t:{duration:arguments[1],easing:arguments[2],complete:arguments[3]};var o=this.$el.position().top;return t.step=i.bind(function(e){this.moveY(e-o,{force:!0}),o=e},this),this.$el.animate({top:parseFloat(this.modeld.get("top"))+a},t),e-a},t.animateToLeft=function(e,t){return-1*this.animateX(-1*e,t)},t.animateToRight=function(e,t){return this.animateX(e,t)},t.animateToTop=function(e,t){return-1*this.animateY(-1*e,t)},t.animateToBottom=function(e,t){return this.animateY(e,t)}}),define("__backbone-ui-draggable/event-handlers",["require","exports","module"],function(e,t){t.mousedown=function(e){if(this.$el.is(e.target)&&1===e.which&&this.draggableEnabled()){this.lastPosition={x:e.pageX,y:e.pageY};var t=this.$el.offset();return this.handlePosition={x:e.pageX-t.left,y:e.pageY-t.top},this.$window.on("mousemove",this.mousemove).on("mouseup",this.mouseup),this.trigger("movestart",this),!1}},t.mousemove=function(e){var t=this.lastPosition,i=e.pageX,a=e.pageY,o=i-t.x,n=a-t.y,s=this.$el.offset(),l=this.handlePosition.x+s.left,r=this.handlePosition.y+s.top;return(o>0&&i>l||0>o&&l>i)&&this.moveX(o,{agent:"mousemove"}),(n>0&&a>r||0>n&&r>a)&&this.moveY(n,{agent:"mousemove"}),t.x=i,t.y=a,!1},t.mouseup=function(){this.$window.off("mousemove",this.mousemove),delete this.lastPosition,this.trigger("movestop",this)}}),define("__backbone-ui-draggable/enable-disable",["require","exports","module"],function(e,t){t.initializeUIDraggableEnableDisable=function(){var e=this.modeld;this.listenTo(e,"change:draggableStatus",function(){this.draggableEnabled()?this.$el.removeClass(this.draggableClass+"-disabled").addClass(this.draggableClass+"-enabled"):this.$el.removeClass(this.draggableClass+"-enabled").addClass(this.draggableClass+"-disabled")})},t.disableDraggable=function(){this.modeld.set("draggableStatus","disabled")},t.enableDraggable=function(){this.modeld.set("draggableStatus","enabled")},t.draggableEnabled=function(){return"enabled"===this.modeld.get("draggableStatus")}}),define("backbone-ui-draggable",["require","exports","module","lowercase-backbone","bb-model-view","lodash","jquery","./__backbone-ui-draggable/helpers","./__backbone-ui-draggable/when","./__backbone-ui-draggable/delta-calc","./__backbone-ui-draggable/movement","./__backbone-ui-draggable/animation","./__backbone-ui-draggable/event-handlers","./__backbone-ui-draggable/enable-disable"],function(e,t,i){var a=e("lowercase-backbone"),o=e("bb-model-view"),n=e("lodash"),s=e("jquery"),l=e("./__backbone-ui-draggable/helpers"),r=i.exports=o.extend({initialize:function(e){a.view.prototype.initialize.call(this,e),this.initializeModelView(e),this.initializeUIDraggable(e)},initializeUIDraggable:function(e){n.bindAll(this,"mousedown","mousemove","mouseup"),this.$el.addClass(this.draggableClass),this.$window=s(window),this.$canvas=e.canvas||this.canvas||this.$el.parent(),this.initializeUIDraggableEnableDisable();var t=this.$el.position(),i=s.extend({draggableStatus:"enabled",top:parseFloat(t.top),left:parseFloat(t.left)},e);this.modeld.set(i)},draggableClass:"draggable",events:{mousedown:"mousedown"},when:e("./__backbone-ui-draggable/when"),axis:"xy",map:{left:"->css:left",top:"->css:top"},stringifiers:{left:l.stringifyPositionalValue,top:l.stringifyPositionalValue}});r.proto(e("./__backbone-ui-draggable/delta-calc")).proto(e("./__backbone-ui-draggable/movement")).proto(e("./__backbone-ui-draggable/animation")).proto(e("./__backbone-ui-draggable/event-handlers")).proto(e("./__backbone-ui-draggable/enable-disable"))});