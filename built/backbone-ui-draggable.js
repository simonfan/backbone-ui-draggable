//     subject
//     (c) simonfan
//     subject is licensed under the MIT terms.

//     Iterator
//     (c) simonfan
//     Iterator is licensed under the MIT terms.

//     Deep
//     (c) simonfan
//     Deep is licensed under the MIT terms.

//     Containers
//     (c) simonfan
//     Containers is licensed under the MIT terms.

//     ObjectMatcher
//     (c) simonfan
//     ObjectMatcher is licensed under the MIT terms.

//     BackboneUiDraggable
//     (c) simonfan
//     BackboneUiDraggable is licensed under the MIT terms.

define("__backbone-ui-draggable/helpers",["require","exports","module"],function(e,t){t.min=function(e,t){return isNaN(e)?t:isNaN(t)?e:t>e?e:t},t.max=function(e,t){return isNaN(e)?t:isNaN(t)?e:e>t?e:t},t.fitValueWithin=function(e,t,n){return isNaN(t)||(e=e>t?e:t),isNaN(n)||(e=n>e?e:n),e};var n=/^-?\d*(\.\d+)?$/;t.stringifyPositionalValue=function(e){return n.test(e)?e+"px":e}}),define("subject",["lodash"],function(e){var t={initialize:function(){}},n=function(){};return n.prototype=t,n.proto=function(t,n){return e.isObject(t)?e.assign(this.prototype,t):this.prototype[t]=n,this},n.extend=function(t,n,r){var i,o;e.isFunction(t)?(i=e.assign({},n,{initialize:t}),o=r):e.isObject(t)&&(i=t||{},o=r);var a,s=this;return a=function(){var e=Object.create(a.prototype);return e.initialize.apply(e,arguments),e},e.assign(a,s,o),a.prototype=Object.create(s.prototype),a.prototype.constructor=a,a.proto(i),a.__super__=s.prototype,a},n.extend.bind(n)}),define("iterator/base",["subject","lodash"],function(e,t){var n=e(function(e,t){this.data=e,t=t||{},this.currentIndex=t.startAt||-1,this.options=t,this.evaluate=t.evaluate||t.evaluator||this.evaluate});n.proto({move:function(e){return this.index(this.currentIndex+e),this},evaluate:function(e){return e},evaluator:function(e){return this.evaluate=e,this},start:function(){return this.currentIndex=-1,this},end:function(){return this.currentIndex=this.length(),this},index:function(e){if(e>this.length()-1||0>e)throw new Error("No such index "+e);return this.currentIndex=e,this},countBefore:function(){return this.currentIndex+1},countAfter:function(){return this.length()-(this.currentIndex+1)},range:function(e,t){for(var n=[];t>=e;)n.push(this.at(e)),e++;return n},hasNext:function(){return this.currentIndex<this.length()-1},next:function(){return this.move(1),this.current()},nextN:function(e){for(var t=[],n=this.currentIndex+e-1;this.hasNext()&&this.currentIndex<=n;)t.push(this.next());return t},hasPrevious:function(){return this.currentIndex>0},previous:function(){return this.move(-1),this.current()},previousN:function(e){for(var t=[],n=this.currentIndex-e+1;this.hasPrevious()&&this.currentIndex>=n;)t.push(this.previous());return t},current:function(){return this.at(this.currentIndex)},value:function(){return this.data}}),n.proto({hasPrev:n.prototype.hasPrevious,prev:n.prototype.previous,prevN:n.prototype.previousN});var r=["map","filter","compact","difference"];return t.each(r,function(e){n.proto(e,function(){var n=t(this.data);n=n[e].apply(n,arguments);var r=this.constructor(n.value());return r})}),n}),define("iterator/array",["require","exports","module","./base","lodash"],function(e){var t=e("./base"),n=e("lodash"),r=t.extend({at:function(e){return this.evaluate(this.data[e],e)},length:function(){return this.data.length}}),i=["push","reverse","shift","sort","splice","unshift"];return n.each(i,function(e){r.proto(e,function(){return this.data[e].apply(this.data,arguments),this})}),n.each(["concat","slice"],function(e){r.proto(e,function(){var t=this.data[e].apply(this.data,arguments);return this.constructor(t)})}),r}),define("iterator/object",["require","exports","module","./base","lodash"],function(e){var t=e("./base"),n=e("lodash"),r=t.extend({initialize:function(e,r){r=r||{},t.prototype.initialize.apply(this,arguments),this.order=r.order||n.keys(e)},keyAt:function(e){return this.order[e]},at:function(e){var t=this.keyAt(e),n=this.data[t];return this.evaluate(n,t)},length:function(){return this.order.length},nextKey:function(){return this.keyAt(this.currentIndex+1)},currentKey:function(){return this.keyAt(this.currentIndex)},previousKey:function(){return this.keyAt(this.currentIndex-1)},map:function(e){var t={};return n.each(this.order,function(n,r){t[n]=e(this.data[n],n,r)}.bind(this)),this.constructor(t)}});return r.proto("constructor",r),r}),define("iterator/number",["require","exports","module","./base"],function(e){var t=e("./base"),n=t.extend({at:function(e){return this.evaluate(e,e)},length:function(){return this.data}});return n}),define("itr",["require","exports","module","./iterator/array","./iterator/object","./iterator/number","lodash"],function(e){var t=e("./iterator/array"),n=e("./iterator/object"),r=e("./iterator/number"),i=e("lodash"),o=function(e){var o;return i.isArray(e)?o=t:i.isObject(e)?o=n:i.isNumber(e)&&(o=r),o.apply(this,arguments)};return o.object=n,o.array=t,o.number=r,o}),define("__deep__/keys",["require","exports","module"],function(){return function(e){return e.replace(/\[(["']?)([^\1]+?)\1?\]/g,".$2").replace(/^\./,"").split(".")}}),define("__deep__/walker",["require","exports","module","lodash","itr","./keys"],function(e,t,n){var r=e("lodash"),i=e("itr"),o=e("./keys"),a=i.object.extend({nextStep:function(){var e=new RegExp("^"+this.currentKey()+"\\.");return this.nextKey().replace(e,"")},currentStep:function(){var e=new RegExp("^"+this.previousKey()+"\\.");return this.currentKey().replace(e,"")},previousStep:function(){var e=this.previousKey()||"";return r.last(e.split("."))},remainingSteps:function(){var e=new RegExp("^"+this.currentKey()+"\\.");return this.destination().replace(e,"")},destination:function(){return r.last(this.order)}});n.exports=function(e,t){t=r.isArray(t)?t:o(t);var n={"":e},i=[""];return r.every(t,function(o,a){var s=r.first(t,a+1).join(".");return i.push(s),e=e[o],n[s]=e,!r.isUndefined(e)}),a(n,{order:i})}}),define("__deep__/getset",["require","exports","module","lodash","./keys"],function(e,t){var n=e("lodash"),r=e("./keys");t.get=function(e,t){return t=n.isArray(t)?t:r(t),n.reduce(t,function(e,t){return e[t]},e)},t.set=function(e,i,o){i=n.isArray(i)?i:r(i);var a=i.pop();e=t.get(e,i),e[a]=o}}),define("deep",["require","exports","module","lodash","./__deep__/keys","./__deep__/walker","./__deep__/getset"],function(e){var t=e("lodash"),n={};return n.parseKeys=e("./__deep__/keys"),n.walker=e("./__deep__/walker"),t.extend(n,e("./__deep__/getset")),n}),define("containers",["lodash"],function(){function e(e,t){return _.all(t,function(t){return _.contains(e,t)})}function t(e,t){return _.any(t,function(t){return _.contains(e,t)})}function n(e,t){return e[0]<t&&t<e[1]}function r(e,t){return e[0]<=t&&t<=e[1]}function i(e,t,i){var o=i?n:r;return o=_.partial(o,e),_.isArray(t)?_.every(t,o):o(t)}return{containsAll:e,containsAny:t,exclusiveWithin:n,inclusiveWithin:r,within:i}}),define("__object-query__/operators/match",["require","exports","module","lodash"],function(e,t){var n=e("lodash");t.$matchSingle=function(e,t){return n.isRegExp(e)?e.test(t):e===t},t.$match=function(e,r){return n.isArray(r)?n.any(r,function(n){return t.$matchSingle(e,n)}):t.$matchSingle(e,r)}}),define("__object-query__/operators/range",["require","exports","module"],function(e,t){t.$lt=function(e,t){return e>t},t.$lte=function(e,t){return e>=t},t.$gt=function(e,t){return t>e},t.$gte=function(e,t){return t>=e}}),define("__object-query__/operators/set",["require","exports","module","lodash","containers"],function(e,t){var n=e("lodash"),r=e("containers");t.$in=function(e,t){return n.isArray(t)?r.containsAny(e,t):n.contains(e,t)},t.$nin=function(e,t){return n.isArray(t)?!r.containsAny(e,t):!n.contains(e,t)},t.$all=function(e,t){return r.containsAll(t,e)}}),define("__object-query__/operators/boolean",["require","exports","module"],function(e,t){t.$e=function(){},t.$ne=function(){},t.$not=function(){},t.$or=function(){},t.$and=function(){},t.$exists=function(){}}),define("__object-query__/operators/index",["require","exports","module","lodash","deep","containers","./match","./range","./set","./boolean"],function(e,t){var n=e("lodash");e("deep"),e("containers"),n.extend(t,e("./match"),e("./range"),e("./set"),e("./boolean")),t.evaluateValue=function(e,r){return n.isObject(e)&&!n.isRegExp(e)?n.every(e,function(e,n){var i=t[n];if(i)return i(e,r);throw new Error("The operator "+n+" is not supported by object-query.")}):t.$match(e,r)}}),define("__object-query__/match",["require","exports","module","lodash","deep","./operators/index"],function(e,t,n){var r=e("lodash"),i=e("deep"),o=e("./operators/index"),a=/[0-9]+/,s=function(e,t,n){return r.any(t,function(t){return u(e,t,n)})},u=n.exports=function(e,t,n){for(var u,l=i.walker(t,n);l.hasNext();){var c=l.next();if(!l.hasNext()){u=o.evaluateValue(e,c);break}if(r.isArray(c)&&!a.test(l.nextStep())){u=s(e,c,l.remainingSteps());break}}return u}}),define("__object-query__/find",["require","exports","module","lodash","deep","./operators/index"],function(e,t,n){var r=e("lodash"),i=e("deep"),o=e("./operators/index"),a=/[0-9]+/,s=function(e,t,n){return r.any(t,function(t){return u(e,t,n)})},u=n.exports=function(e,t,n){for(var u,l=i.walker(t,n);l.hasNext();){var c=l.next();if(!l.hasNext()){u=o.evaluateValue(e,c);break}if(r.isArray(c)&&!a.test(l.nextStep())){u=s(e,c,l.remainingSteps());break}}return u}}),define("object-query",["require","exports","module","lodash","./__object-query__/match","./__object-query__/find"],function(e){function t(e,t){return n.every(e,function(e,n){return r(e,t,n)})}var n=e("lodash"),r=e("./__object-query__/match");e("./__object-query__/find");var i=function(e){return e=e||{},n.partial(t,e)},o=["every","all","some","any","filter","find","reject"];return n.each(o,function(e){i[e]=function(t,r){return n[e](t,i(r))}}),i}),define("__backbone-ui-draggable/when",["require","exports","module","object-query"],function(e,t,n){var r=e("object-query");n.exports=function(e,t,n){var i=r(e),o=this.model;o.on("change",function(){i(o.toJSON())&&t.apply(n,[this])},this)}}),define("__backbone-ui-draggable/value-position",["require","exports","module","./helpers"],function(e,t){e("./helpers");t.initializeDraggableValuePosition=function(){var e=this.model,t=this.valueAttribute;if(this.listenTo(e,"change:"+t,function(e){var n=this.toPosition(e.get(t));e.set({top:parseFloat(n.top),left:parseFloat(n.left)})},this),e.get(t)){var n=this.toPosition(e.get(t));e.set({top:parseFloat(n.top),left:parseFloat(n.left)})}else e.set(t,this.toValue(e))},t.valueAttribute="value",t.setValue=function(e){return this.model.set(this.valueAttribute,e),this},t.toValue=function(e){return"At "+e.get("top")+" x "+e.get("left")},t.toPosition=function(e){var t=e.split("x"),n={top:parseFloat(t[0].replace(/[^0-9.\-]/g,"")),left:parseFloat(t[1].replace(/[^0-9.\-]/g,""))};return n}}),define("__backbone-ui-draggable/delta-calc",["require","exports","module","lodash","./helpers"],function(e,t){var n=(e("lodash"),e("./helpers"));t.xAllowedDelta=function(e){var t=this.model,r=parseFloat(t.get("left")),i=r+e,o=parseFloat(this.$el.width()),a=parseFloat(t.get("minLeft")),s=parseFloat(t.get("minRight")),u=n.max(a,s-o),l=parseFloat(t.get("maxLeft")),c=parseFloat(t.get("maxRight")),h=n.min(l,c-o),d=n.fitValueWithin(i,u,h);return d-r},t.yAllowedDelta=function(e){var t=this.model,r=parseFloat(t.get("top")),i=r+e,o=parseFloat(this.$el.height()),a=parseFloat(t.get("minTop")),s=parseFloat(t.get("minBottom")),u=n.max(a,s-o),l=parseFloat(t.get("maxTop")),c=parseFloat(t.get("maxBottom")),h=n.min(l,c-o),d=n.fitValueWithin(i,u,h);return d-r}}),define("__backbone-ui-draggable/movement",["require","exports","module","lodash","./helpers"],function(e,t){{var n=e("lodash");e("./helpers")}t.moveX=function(e,t){if(e){if(t=t||{},-1===this.axis.indexOf("x"))return e;var r=this.model,i=t.force?e:this.xAllowedDelta(e);if(r.set("left",parseFloat(r.get("left"))+i),r.set(this.valueAttribute,this.toValue(r)),!t.silent&&0!==i){var o=n.assign({axis:"x",delta:i,direction:i>0?"right":"left"},t);this.trigger("move",this,o).trigger("move-x",this,o)}return e-i}return 0},t.moveY=function(e,t){if(e){if(t=t||{},-1===this.axis.indexOf("y"))return e;var r=this.model,i=this.yAllowedDelta(e);if(r.set("top",parseFloat(r.get("top"))+i),r.set(this.valueAttribute,this.toValue(r)),!t.silent&&0!==i){var o=n.assign({axis:"y",delta:i,direction:i>0?"bottom":"top"},t);this.trigger("move",this,o).trigger("move-y",this,o)}return e-i}return 0},t.moveToLeft=function(e,t){return-1*this.moveX(-1*e,t)},t.moveToRight=function(e,t){return this.moveX(e,t)},t.moveToTop=function(e,t){return-1*this.moveY(-1*e,t)},t.moveToBottom=function(e,t){return this.moveY(e,t)}}),define("__backbone-ui-draggable/animation",["require","exports","module","lodash"],function(e,t){var n=e("lodash");t.animateX=function(e,t){var r=this.xAllowedDelta(e);t=t||{},t=n.isObject(t)?t:{duration:arguments[1],easing:arguments[2],complete:arguments[3]};var i=this.$el.position().left;return t.step=n.bind(function(e){this.moveX(e-i,{force:!0}),i=e},this),this.$el.animate({left:parseFloat(this.model.get("left"))+r},t),e-r},t.animateY=function(e,t){var r=this.yAllowedDelta(e);t=t||{},t=n.isObject(t)?t:{duration:arguments[1],easing:arguments[2],complete:arguments[3]};var i=this.$el.position().top;return t.step=n.bind(function(e){this.moveY(e-i,{force:!0}),i=e},this),this.$el.animate({top:parseFloat(this.model.get("top"))+r},t),e-r},t.animateToLeft=function(e,t){return-1*this.animateX(-1*e,t)},t.animateToRight=function(e,t){return this.animateX(e,t)},t.animateToTop=function(e,t){return-1*this.animateY(-1*e,t)},t.animateToBottom=function(e,t){return this.animateY(e,t)}}),define("__backbone-ui-draggable/event-handlers",["require","exports","module"],function(e,t){t.mousedown=function(e){if(this.$el.is(e.target)&&1===e.which&&this.draggableEnabled()){this.lastPosition={x:e.pageX,y:e.pageY};var t=this.$el.offset();return this.handlePosition={x:e.pageX-t.left,y:e.pageY-t.top},this.$window.on("mousemove",this.mousemove).on("mouseup",this.mouseup),this.trigger("movestart",this),!1}},t.mousemove=function(e){var t=this.lastPosition,n=e.pageX,r=e.pageY,i=n-t.x,o=r-t.y,a=this.$el.offset(),s=this.handlePosition.x+a.left,u=this.handlePosition.y+a.top;return(i>0&&n>s||0>i&&s>n)&&this.moveX(i,{agent:"mousemove"}),(o>0&&r>u||0>o&&u>r)&&this.moveY(o,{agent:"mousemove"}),t.x=n,t.y=r,!1},t.mouseup=function(){this.$window.off("mousemove",this.mousemove),delete this.lastPosition,this.trigger("movestop",this)}}),define("backbone-ui-draggable",["require","exports","module","lowercase-backbone","model-dock","lodash","jquery","./__backbone-ui-draggable/helpers","./__backbone-ui-draggable/when","./__backbone-ui-draggable/value-position","./__backbone-ui-draggable/delta-calc","./__backbone-ui-draggable/movement","./__backbone-ui-draggable/animation","./__backbone-ui-draggable/event-handlers"],function(e,t,n){var r=e("lowercase-backbone"),i=e("model-dock"),o=e("lodash"),a=e("jquery"),s=e("./__backbone-ui-draggable/helpers"),u=n.exports=i.extend({initialize:function(e){r.view.prototype.initialize.call(this,e),this.initializeModelDock(e),this.initializeUIDraggable(e)},initializeUIDraggable:function(e){o.bindAll(this,"mousedown","mousemove","mouseup"),this.$el.addClass(this.draggableClass),this.$window=a(window),this.$canvas=e.canvas||this.canvas||this.$el.parent();var t=this.$el.position(),n=a.extend({"draggable-status":"enabled",disabled:!1,top:parseFloat(t.top),left:parseFloat(t.left)},e),r=this.model;r.set(n),this.listenTo(r,"change:draggable-status",function(){this.draggableEnabled()?this.$el.removeClass(this.draggableClass+"-disabled").addClass(this.draggableClass+"-enabled"):this.$el.removeClass(this.draggableClass+"-enabled").addClass(this.draggableClass+"-disabled")}),this.initializeDraggableValuePosition(e)},draggableClass:"draggable",events:{mousedown:"mousedown"},when:e("./__backbone-ui-draggable/when"),disableDraggable:function(){this.model.set("draggable-status","disabled")},enableDraggable:function(){this.model.set("draggable-status","enabled")},draggableEnabled:function(){return"enabled"===this.model.get("draggable-status")},axis:"xy",map:{left:"->css:left",top:"->css:top"},stringifiers:{left:s.stringifyPositionalValue,top:s.stringifyPositionalValue}});u.proto(e("./__backbone-ui-draggable/value-position")),u.proto(e("./__backbone-ui-draggable/delta-calc")),u.proto(e("./__backbone-ui-draggable/movement")),u.proto(e("./__backbone-ui-draggable/animation")),u.proto(e("./__backbone-ui-draggable/event-handlers"))});