//     BackboneUiDraggable
//     (c) simonfan
//     BackboneUiDraggable is licensed under the MIT terms.

define("__backbone-ui-draggable/move",["require","exports","module"],function(t,e){function i(t,e,i){return isNaN(e)||(t=t>e?t:e),isNaN(i)||(t=i>t?t:i),t}e.moveX=function(t,e){if(t){if(-1===this.axis.indexOf("x"))return t;var o=this.model,s=parseInt(o.get("left"),10),n=s+t,a=i(n,o.get("minX"),o.get("maxX"));o.set("left",a),o.set(this.valueAttribute,this.toValue(o));var r=o.get("left")-s;return e||this.trigger("move",this,{axis:"x",delta:r}).trigger("move-x",this,r),t-r}return 0},e.moveY=function(t,e){if(t){if(-1===this.axis.indexOf("y"))return t;var o=this.model,s=parseInt(o.get("top"),10),n=s+t,a=i(n,o.get("minY"),o.get("maxY"));o.set("top",a),o.set(this.valueAttribute,this.toValue(o));var r=o.get("top")-s;return e||this.trigger("move",this,{axis:"y",delta:r}).trigger("move-y",this,r),t-r}return 0},e.moveToLeft=function(t,e){return this.moveX(-1*t,e)},e.moveToRight=function(t,e){return this.moveX(t,e)},e.moveToTop=function(t,e){return this.moveY(-1*t,e)},e.moveToBottom=function(t,e){return this.moveY(t,e)}}),define("backbone-ui-draggable",["require","exports","module","lowercase-backbone","model-dock","lodash","jquery","./__backbone-ui-draggable/move"],function(t,e,i){function o(t){return u.test(t)?t+"px":t}var s=t("lowercase-backbone"),n=t("model-dock"),a=t("lodash"),r=t("jquery"),u=/^[0-9\-]+$/,h=i.exports=n.extend({initialize:function(t){s.view.prototype.initialize.call(this,t),this.initializeModelDock(t),this.initializeUIDraggable(t)},initializeUIDraggable:function(t){a.bindAll(this,"mousedown","mousemove","mouseup"),this.$window=r(window),this.$canvas=t.canvas||this.canvas||this.$window;var e=r.extend({status:"stopped",minX:0,maxX:this.$canvas.width()-this.$el.width(),minY:0,maxY:this.$canvas.height()-this.$el.height()},this.$el.position(),t),i=this.model;i.set(e);var o=this.valueAttribute;this.listenTo(i,"change:"+o,function(t,e){t.set(this.toPosition(e))},this),i.get(o)?i.set(this.toPosition(i.get(o))):i.set(o,this.toValue(i))},events:{mousedown:"mousedown"},mousedown:function(t){if(this.$el.is(t.target)&&1===t.which){this.model.set("status","dragging"),this.lastPosition={x:t.pageX,y:t.pageY};var e=this.$el.offset();return this.handlePosition={x:t.pageX-e.left,y:t.pageY-e.top},this.$window.on("mousemove",this.mousemove).on("mouseup",this.mouseup),this.trigger("movestart",this),!1}},mousemove:function(t){var e=this.lastPosition,i=t.pageX,o=t.pageY,s=i-e.x,n=o-e.y,a=this.$el.offset(),r=this.handlePosition.x+a.left,u=this.handlePosition.y+a.top;return(s>0&&i>r||0>s&&r>i)&&this.moveX(s),(n>0&&o>u||0>n&&u>o)&&this.moveY(n),e.x=i,e.y=o,!1},mouseup:function(){this.$window.off("mousemove",this.mousemove),delete this.lastPosition,this.model.set("status","stopped"),this.trigger("movestop",this)},axis:"xy",valueAttribute:"value",setValue:function(t){return this.model.set(this.valueAttribute,t),this},toValue:function(t){return"At "+t.get("top")+" x "+t.get("left")},toPosition:function(t){var e=t.split("x");return{top:e[0].replace(/[^0-9\-]/g,""),left:e[1].replace(/[^0-9\-]/g,"")}},map:{left:"->css:left",top:"->css:top"},stringifiers:{left:o,top:o}});h.proto(t("./__backbone-ui-draggable/move"))});