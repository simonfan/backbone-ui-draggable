//     BackboneUiDraggable
//     (c) simonfan
//     BackboneUiDraggable is licensed under the MIT terms.

define("__backbone-ui-draggable/helpers",["require","exports","module"],function(e,t){t.min=function(e,t){return isNaN(e)?t:isNaN(t)?e:t>e?e:t},t.max=function(e,t){return isNaN(e)?t:isNaN(t)?e:e>t?e:t},t.fitValueWithin=function(e,t,i){return isNaN(t)||(e=e>t?e:t),isNaN(i)||(e=i>e?e:i),e};var i=/^-?\d*(\.\d+)?$/;t.stringifyPositionalValue=function(e){return i.test(e)?e+"px":e}}),define("__backbone-ui-draggable/when",["require","exports","module","object-query"],function(e,t,i){var a=e("object-query");i.exports=function(e,t,i){var o=a(e),s=this.model;s.on("change",function(){o(s.toJSON())&&t.apply(i,[this])},this)}}),define("__backbone-ui-draggable/value-position",["require","exports","module","./helpers"],function(e,t){e("./helpers");t.initializeDraggableValuePosition=function(){var e=this.model,t=this.valueAttribute;if(this.listenTo(e,"change:"+t,function(e){var i=this.toPosition(e.get(t));e.set({top:parseFloat(i.top),left:parseFloat(i.left)})},this),e.get(t)){var i=this.toPosition(e.get(t));e.set({top:parseFloat(i.top),left:parseFloat(i.left)})}else e.set(t,this.toValue(e))},t.valueAttribute="value",t.setValue=function(e){return this.model.set(this.valueAttribute,e),this},t.toValue=function(e){return"At "+e.get("top")+" x "+e.get("left")},t.toPosition=function(e){var t=e.split("x"),i={top:parseFloat(t[0].replace(/[^0-9.\-]/g,"")),left:parseFloat(t[1].replace(/[^0-9.\-]/g,""))};return i}}),define("__backbone-ui-draggable/delta-calc",["require","exports","module","lodash","./helpers"],function(e,t){var i=(e("lodash"),e("./helpers"));t.xAllowedDelta=function(e){var t=this.model,a=parseFloat(t.get("left")),o=a+e,s=parseFloat(this.$el.width()),n=parseFloat(t.get("minLeft")),l=parseFloat(t.get("minRight")),r=i.max(n,l-s),u=parseFloat(t.get("maxLeft")),g=parseFloat(t.get("maxRight")),h=i.min(u,g-s),d=i.fitValueWithin(o,r,h);return d-a},t.yAllowedDelta=function(e){var t=this.model,a=parseFloat(t.get("top")),o=a+e,s=parseFloat(this.$el.height()),n=parseFloat(t.get("minTop")),l=parseFloat(t.get("minBottom")),r=i.max(n,l-s),u=parseFloat(t.get("maxTop")),g=parseFloat(t.get("maxBottom")),h=i.min(u,g-s),d=i.fitValueWithin(o,r,h);return d-a}}),define("__backbone-ui-draggable/movement",["require","exports","module","lodash","./helpers"],function(e,t){{var i=e("lodash");e("./helpers")}t.beforeMoveX=function(){},t.moveX=function(e,t){if(e){if(t=t||{},-1===this.axis.indexOf("x"))return e;var a=this.model,o=t.force?e:this.xAllowedDelta(e),s=this.beforeMoveX(o,t);if(o=i.isNumber(s)?s:o,a.set("left",parseFloat(a.get("left"))+o),a.set(this.valueAttribute,this.toValue(a)),!t.silent&&0!==o){var n=i.assign({axis:"x",delta:o,direction:o>0?"right":"left"},t);this.trigger("move",this,n).trigger("move-x",this,n)}return e-o}return 0},t.beforeMoveY=function(){},t.moveY=function(e,t){if(e){if(t=t||{},-1===this.axis.indexOf("y"))return e;var a=this.model,o=this.yAllowedDelta(e),s=this.beforeMoveY(o,t);if(o=i.isNumber(s)?s:o,a.set("top",parseFloat(a.get("top"))+o),a.set(this.valueAttribute,this.toValue(a)),!t.silent&&0!==o){var n=i.assign({axis:"y",delta:o,direction:o>0?"bottom":"top"},t);this.trigger("move",this,n).trigger("move-y",this,n)}return e-o}return 0},t.moveToLeft=function(e,t){return-1*this.moveX(-1*e,t)},t.moveToRight=function(e,t){return this.moveX(e,t)},t.moveToTop=function(e,t){return-1*this.moveY(-1*e,t)},t.moveToBottom=function(e,t){return this.moveY(e,t)}}),define("__backbone-ui-draggable/animation",["require","exports","module","lodash"],function(e,t){var i=e("lodash");t.animateX=function(e,t){var a=this.xAllowedDelta(e);t=t||{},t=i.isObject(t)?t:{duration:arguments[1],easing:arguments[2],complete:arguments[3]};var o=this.$el.position().left;return t.step=i.bind(function(e){this.moveX(e-o,{force:!0}),o=e},this),this.$el.animate({left:parseFloat(this.model.get("left"))+a},t),e-a},t.animateY=function(e,t){var a=this.yAllowedDelta(e);t=t||{},t=i.isObject(t)?t:{duration:arguments[1],easing:arguments[2],complete:arguments[3]};var o=this.$el.position().top;return t.step=i.bind(function(e){this.moveY(e-o,{force:!0}),o=e},this),this.$el.animate({top:parseFloat(this.model.get("top"))+a},t),e-a},t.animateToLeft=function(e,t){return-1*this.animateX(-1*e,t)},t.animateToRight=function(e,t){return this.animateX(e,t)},t.animateToTop=function(e,t){return-1*this.animateY(-1*e,t)},t.animateToBottom=function(e,t){return this.animateY(e,t)}}),define("__backbone-ui-draggable/event-handlers",["require","exports","module"],function(e,t){t.mousedown=function(e){if(this.$el.is(e.target)&&1===e.which&&this.draggableEnabled()){this.lastPosition={x:e.pageX,y:e.pageY};var t=this.$el.offset();return this.handlePosition={x:e.pageX-t.left,y:e.pageY-t.top},this.$window.on("mousemove",this.mousemove).on("mouseup",this.mouseup),this.trigger("movestart",this),!1}},t.mousemove=function(e){var t=this.lastPosition,i=e.pageX,a=e.pageY,o=i-t.x,s=a-t.y,n=this.$el.offset(),l=this.handlePosition.x+n.left,r=this.handlePosition.y+n.top;return(o>0&&i>l||0>o&&l>i)&&this.moveX(o,{agent:"mousemove"}),(s>0&&a>r||0>s&&r>a)&&this.moveY(s,{agent:"mousemove"}),t.x=i,t.y=a,!1},t.mouseup=function(){this.$window.off("mousemove",this.mousemove),delete this.lastPosition,this.trigger("movestop",this)}}),define("backbone-ui-draggable",["require","exports","module","lowercase-backbone","model-dock","lodash","jquery","./__backbone-ui-draggable/helpers","./__backbone-ui-draggable/when","./__backbone-ui-draggable/value-position","./__backbone-ui-draggable/delta-calc","./__backbone-ui-draggable/movement","./__backbone-ui-draggable/animation","./__backbone-ui-draggable/event-handlers"],function(e,t,i){var a=e("lowercase-backbone"),o=e("model-dock"),s=e("lodash"),n=e("jquery"),l=e("./__backbone-ui-draggable/helpers"),r=i.exports=o.extend({initialize:function(e){a.view.prototype.initialize.call(this,e),this.initializeModelDock(e),this.initializeUIDraggable(e)},initializeUIDraggable:function(e){s.bindAll(this,"mousedown","mousemove","mouseup"),this.$el.addClass(this.draggableClass),this.$window=n(window),this.$canvas=e.canvas||this.canvas||this.$el.parent();var t=this.$el.position(),i=n.extend({draggableStatus:"enabled",disabled:!1,top:parseFloat(t.top),left:parseFloat(t.left)},e),a=this.model;a.set(i),this.listenTo(a,"change:draggableStatus",function(){this.draggableEnabled()?this.$el.removeClass(this.draggableClass+"-disabled").addClass(this.draggableClass+"-enabled"):this.$el.removeClass(this.draggableClass+"-enabled").addClass(this.draggableClass+"-disabled")}),this.initializeDraggableValuePosition(e)},draggableClass:"draggable",events:{mousedown:"mousedown"},when:e("./__backbone-ui-draggable/when"),disableDraggable:function(){this.model.set("draggableStatus","disabled")},enableDraggable:function(){this.model.set("draggableStatus","enabled")},draggableEnabled:function(){return"enabled"===this.model.get("draggableStatus")},axis:"xy",map:{left:"->css:left",top:"->css:top"},stringifiers:{left:l.stringifyPositionalValue,top:l.stringifyPositionalValue}});r.proto(e("./__backbone-ui-draggable/value-position")),r.proto(e("./__backbone-ui-draggable/delta-calc")),r.proto(e("./__backbone-ui-draggable/movement")),r.proto(e("./__backbone-ui-draggable/animation")),r.proto(e("./__backbone-ui-draggable/event-handlers"))});