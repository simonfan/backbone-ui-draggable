<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src/index.js - backbone-ui-draggable</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="backbone-ui-draggable"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/BackboneUiDraggable.html">BackboneUiDraggable</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src/index.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
//     BackboneUiDraggable
//     (c) simonfan
//     BackboneUiDraggable is licensed under the MIT terms.

/**
 * AMD module.
 *
 * @module BackboneUiDraggable
 */

define(function (require, exports, module) {
	&#x27;use strict&#x27;;

	var backbone = require(&#x27;lowercase-backbone&#x27;),
		modelDock = require(&#x27;model-dock&#x27;),
		_ = require(&#x27;lodash&#x27;),
		$ = require(&#x27;jquery&#x27;);
	/**
	 * Just adds &#x27;px&#x27; string to numerical values.
	 *
	 * @method stringifyPositionalValue
	 * @private
	 */
	var isNumber = /^[0-9\-]+$/;
	function stringifyPositionalValue(v) {
		// [1] check if it is a isNumber
		return isNumber.test(v) ? v + &#x27;px&#x27; : v;
	}

	function numberify(v) {
		return parseInt(v);
	}



	var draggable = module.exports = modelDock.extend({
		initialize: function initialize(options) {

			backbone.view.prototype.initialize.call(this, options);

			this.initializeModelDock(options);

			this.initializeUIDraggable(options);
		},

		initializeUIDraggable: function initializeUIDraggable(options) {

			// bind methods
			_.bindAll(this, &#x27;mousedown&#x27;, &#x27;mousemove&#x27;, &#x27;mouseup&#x27;);

			// window
			this.$window = $(window);

			// canvas
			this.$canvas = options.canvas || this.canvas || this.$el.parent();

			var pos = this.$el.position();

			var data = $.extend({
				status: &#x27;stopped&#x27;,

		//		minX: 0,
		//		maxX: numberify(this.$canvas.width()) - numberify(this.$el.width()),

		//		minY: 0,
		//		maxY: numberify(this.$canvas.height()) - numberify(this.$el.height()),

				top: numberify(pos.top),
				left: numberify(pos.left)

			}, options);

			// set initial position

			var model = this.model;

			model.set(data);

			// listen to changes on value attribute
			var valueAttribute = this.valueAttribute;
			this.listenTo(model, &#x27;change:&#x27; + valueAttribute, function (model, value) {

				var pos = this.toPosition(model.get(valueAttribute));

				model.set({
					top: numberify(pos.top),
					left: numberify(pos.left)
				});

			}, this);

			// initialize value/position
			if (model.get(valueAttribute)) {
				var pos = this.toPosition(model.get(valueAttribute));

				model.set({
					top: numberify(pos.top),
					left: numberify(pos.left)
				});
			} else {
				model.set(valueAttribute, this.toValue(model));
			}

		},

		events: {
			mousedown: &#x27;mousedown&#x27;,
		},

		mousedown: function mousedown(e) {

			if (this.$el.is(e.target) &amp;&amp; e.which === 1) {

				this.model.set(&#x27;status&#x27;, &#x27;dragging&#x27;);

				this.lastPosition = {
					x: e.pageX,
					y: e.pageY
				};


				var offset = this.$el.offset();

				this.handlePosition = {
					x: e.pageX - offset.left,
					y: e.pageY - offset.top
				};

				this.$window
					.on(&#x27;mousemove&#x27;, this.mousemove)
					.on(&#x27;mouseup&#x27;, this.mouseup);

				this.trigger(&#x27;movestart&#x27;, this);

				// preventDefault AND stopPropagation
				// http://stackoverflow.com/questions/1357118/event-preventdefault-vs-return-false
				return false;

			}
		},

		mousemove: function mousemove(e) {

			var last = this.lastPosition,
				x = e.pageX,
				y = e.pageY,
				dx = x - last.x,
				dy = y - last.y;


			var offset = this.$el.offset(),
				handleX = this.handlePosition.x + offset.left,
				handleY = this.handlePosition.y + offset.top;


			if ((dx &gt; 0 &amp;&amp; x &gt; handleX ) || (dx &lt; 0 &amp;&amp; x &lt; handleX)) {
				this.moveX(dx);
			}

			if ((dy &gt; 0 &amp;&amp; y &gt; handleY) || (dy &lt; 0 &amp;&amp; y &lt; handleY)) {
				this.moveY(dy);
			}

			last.x = x;
			last.y = y;

			// preventDefault AND stopPropagation
			return false;
		},

		mouseup: function mouseup() {
			this.$window.off(&#x27;mousemove&#x27;, this.mousemove);

			delete this.lastPosition;

			this.model.set(&#x27;status&#x27;, &#x27;stopped&#x27;);


			this.trigger(&#x27;movestop&#x27;, this);

			// preventDefault AND stopPropagation
			//return false;
		},

		axis: &#x27;xy&#x27;,

		valueAttribute: &#x27;value&#x27;,

		setValue: function setValue(value) {
			this.model.set(this.valueAttribute, value);
			return this;
		},

		toValue: function toValue(model) {
			return &#x27;At &#x27; + model.get(&#x27;top&#x27;) + &#x27; x &#x27; + model.get(&#x27;left&#x27;);
		},

		toPosition: function toPosition(value) {
			var values = value.split(&#x27;x&#x27;);

			return {
				top: values[0].replace(/[^0-9\-]/g, &#x27;&#x27;),
				left: values[1].replace(/[^0-9\-]/g, &#x27;&#x27;),
			};
		},

		map: {
			left: &#x27;-&gt;css:left&#x27;,
			top: &#x27;-&gt;css:top&#x27;,
		},

		stringifiers: {
			left: stringifyPositionalValue,
			top: stringifyPositionalValue
		}
	});

	// extend
	draggable.proto(require(&#x27;./__backbone-ui-draggable/move&#x27;));
});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
